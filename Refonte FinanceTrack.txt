üìä FinanceTrack - Sp√©cification Compl√®te des Fonctionnalit√©s
Version: 1.0-draft
Date: 24 janvier 2026
Scope: Sp√©cification fonctionnelle (aucun code, architecture uniquement)

üìã Table des Mati√®res
Vue d'ensemble

Architecture g√©n√©rale

Gestion des banques

Gestion des comptes

Import et d√©tection

Classification des transactions

Interface utilisateur

Workflows et interactions

Vue d'ensemble
Principes fondamentaux
FinanceTrack est une application de gestion financi√®re personnelle bas√©e sur une architecture o√π :

Les banques sont des entit√©s d√©clar√©es manuellement : Aucune donn√©e financi√®re ne peut √™tre import√©e d'une banque qui n'a pas √©t√© explicitement ajout√©e par l'utilisateur √† l'application.

Les comptes sont d√©tect√©s automatiquement : Lors de l'import d'un fichier OFX, l'application identifie automatiquement les comptes pr√©sents dans ce fichier et les lie √† une banque d√©clar√©e.

Les transactions sont cat√©goris√©es intelligemment : Chaque transaction re√ßoit une classification permettant de distinguer les mouvements externes (revenus, d√©penses, virements vers des tiers) des mouvements internes (transferts entre comptes personnels).

Objectifs utilisateur
Visualiser rapidement quels comptes bancaires et quelles banques sont int√©gr√©s dans l'application

Ajouter de nouvelles banques sans friction

Importer automatiquement des transactions depuis fichiers OFX sans configuration complexe

Filtrer les transactions pour masquer les virements internes (optionnel)

Gagner une vision claire des flux financiers r√©els (externes) vs mouvements internes

Architecture g√©n√©rale
Hi√©rarchie des √©l√©ments
text
Profile (Utilisateur)
‚îú‚îÄ‚îÄ Bank (Banque d√©clar√©e)
‚îÇ   ‚îú‚îÄ‚îÄ Account (Compte d√©tect√©/cr√©√©)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Transaction (Mouvement financier)
‚îÇ   ‚îî‚îÄ‚îÄ Account
‚îÇ       ‚îî‚îÄ‚îÄ Transaction
‚îú‚îÄ‚îÄ Bank
‚îî‚îÄ‚îÄ Bank
Relations fondamentales
Bank ‚Üí Account : Une banque peut avoir plusieurs comptes (un compte ch√®ques, un compte √©pargne, un cr√©dit, etc.)

Account ‚Üí Transaction : Un compte re√ßoit des transactions lors d'imports OFX ou lors de cr√©ations manuelles

Transaction ‚Üí Classification : Chaque transaction est class√©e comme :

External : Revenu ou d√©pense (mouvement vers un tiers)

Internal Intra-Bank : Virement entre deux comptes de la m√™me banque

Internal Inter-Bank : Virement entre deux comptes de banques diff√©rentes (toutes deux d√©clar√©es)

Unknown : Impossible √† classifier (compte destinataire non d√©clar√© dans l'app)

Sc√©narios de classification
Exemple 1 - Paiement classique

text
Compte: Soci√©t√© G√©n√©rale (Ch√®ques)
Libell√©: AMAZON PAYMENT
Montant: -49.99‚Ç¨

Classification: External
Raison: Le destinataire (Amazon) n'est pas un compte de l'utilisateur
Exemple 2 - Virement intra-bancaire

text
Compte source: Soci√©t√© G√©n√©rale (Ch√®ques)
Compte dest: Soci√©t√© G√©n√©rale (√âpargne)
Libell√©: VIREMENT INTERNE
Montant: +500‚Ç¨

Classification: Internal Intra-Bank
Raison: Les deux comptes appartiennent au m√™me utilisateur et √† la m√™me banque
Exemple 3 - Virement inter-bancaire

text
Compte source: Soci√©t√© G√©n√©rale (Ch√®ques)
Compte dest: BNP Paribas (√âpargne)
Libell√©: VIREMENT √âPARGNE
Montant: +500‚Ç¨

Classification: Internal Inter-Bank
Raison: M√™me utilisateur mais banques diff√©rentes
Exemple 4 - Compte non d√©clar√©

text
Compte source: Soci√©t√© G√©n√©rale (Ch√®ques)
Compte dest: ?????? (Inconnu)
Libell√©: VIREMENT √Ä MARC
Montant: -200‚Ç¨

Classification: Unknown
Raison: Le compte destinataire n'existe pas dans l'application
Gestion des banques
Entit√© Bank
Une banque est un conteneur organisationnel qui regroupe les informations sur une institution financi√®re d√©clar√©e par l'utilisateur.

Attributs d'une Bank

Identifiant unique : UUID g√©n√©r√© √† la cr√©ation

Nom : Cha√Æne de caract√®res (ex: "Soci√©t√© G√©n√©rale", "BNP Paribas", "Revolut")

Code bancaire optionnel : Num√©ro SWIFT/BIC ou code sp√©cifique (ex: "SOGEDFF22" pour SG)

Couleur d'affichage : Hex color pour UI (visuellement identifier chaque banque)

Ic√¥ne/Emoji : Repr√©sentation visuelle (ex: üè¶, üì±, etc.)

Actif : Bool√©en indiquant si la banque est toujours utilis√©e

M√©tadonn√©es : JSON pour info suppl√©mentaire (site web, t√©l√©phone support, etc.)

Date de cr√©ation : Timestamp

Date de modification : Timestamp

Section de gestion des banques
Emplacement : Panneau vertical sur le c√¥t√© droit de la landing page (Dashboard principal)

Hauteur et layout :

Le panneau occupe une largeur fixe (ex: 280-320px) sur la droite de l'√©cran

Il s'√©tend sur toute la hauteur de la page ou est scrollable ind√©pendamment

Responsive : sur mobile, peut glisser en overlay ou se positionner en haut

Sections internes du panneau

Section 1 : Titre et actions
Titre : "Banques & Comptes" ou "Mes Banques"

Bouton d'action : "Ajouter une banque" (ic√¥ne + ou visible √† droite du titre)

Ic√¥ne collapse/expand : Pour r√©duire le panneau (optionnel mais recommand√© sur mobile)

Section 2 : Liste des banques
Affichage par banque :

Ic√¥ne/couleur de la banque

Nom de la banque

Nombre de comptes associ√©s (ex: "3 comptes")

√âtat actif/inactif (indicateur visuel)

Menu contextuel (trois points) pour : √©diter, archiver, supprimer

Interaction expansible :

Clic sur une banque ‚Üí expansion affichant ses comptes en dessous

Fl√®che chevron indiquant l'√©tat expanded/collapsed

Affichage des comptes imbriqu√©s avec indentation visuelle

Section 3 : Liste des comptes (par banque)
Affichage par compte (sous banque expandue) :

Ic√¥ne de type de compte (ch√®ques, √©pargne, cr√©dit, etc.)

Nom du compte (ex: "Ch√®ques Perso", "√âpargne Projet")

Solde actuel affich√© petit (ex: "1,250.50‚Ç¨")

Devise du compte

Dernier import (date/heure)

Menu contextuel pour : √©diter le nom, archiver, supprimer

Section 4 : Bouton "Ajouter une banque"
Emplacement : En bas du panneau (toujours visible m√™me scroll√©)

Texte : "Ajouter une banque" ou "+ Nouvelle banque"

Action : Ouvre modal/formulaire d'ajout de banque

Modal/Formulaire d'ajout de banque
D√©clenchement :

Clic sur "Ajouter une banque" dans le panneau

Ou au premier lancement de l'application (si aucune banque existante)

Champs du formulaire

Nom de la banque (champ texte, requis)

Recherche parmi liste pr√©-remplie de banques populaires (Soci√©t√© G√©n√©rale, BNP, Cr√©dit Agricole, Revolut, Wise, etc.)

Possibilit√© d'entrer un nom personnalis√©

Autocomplete activ√©

Code SWIFT/BIC (champ texte, optionnel)

Auto-rempli si banque s√©lectionn√©e dans liste pr√©-remplie

Valid√© au format SWIFT (8 ou 11 caract√®res alphanum√©riques)

Aide visuelle si format invalide

Couleur d'affichage (color picker, requis)

Palette pr√©d√©finie de couleurs

Ou color picker personnalis√©

Aper√ßu en temps r√©el sur une ic√¥ne exemple

Ic√¥ne/Emoji (s√©lecteur emoji, optionnel)

S√©lection parmi emojis communs (üè¶, üì±, üí≥, üèõÔ∏è, etc.)

Ou saisir emoji personnalis√©

Notes/M√©tadonn√©es (champ texte longue, optionnel)

Pour ajouter site web, num√©ro support, etc.

Actions

Cr√©er : Valide et cr√©e la banque, ferme modal, actualise panneau

Annuler : Ferme modal sans changement

Modification d'une banque
Acc√®s : Menu contextuel ‚Üí "√âditer" sur une banque

Comportement : Ouvre la m√™me modal avec les champs pr√©remplis, permettant modification et sauvegarde

Suppression d'une banque
Acc√®s : Menu contextuel ‚Üí "Supprimer" sur une banque

Validation :

Si banque poss√®de comptes avec transactions : confirmation avec avertissement

Texte warning : "Supprimer cette banque supprimera aussi X comptes et Y transactions. Cette action est irr√©versible."

Boutons : "Supprimer" (rouge) / "Annuler"

Comportement :

Suppression cascade : tous les comptes associ√©s sont supprim√©s

Toutes les transactions associ√©es sont supprim√©es

Rafra√Æchissement du panneau et du dashboard

Archivage d'une banque
Alternative √† la suppression : "Archiver" au lieu de supprimer

Comportement :

Banque reste en base de donn√©es

Appara√Æt sous section "Banques archiv√©es" en bas du panneau (optionnel)

Comptes et transactions restent intacts mais masqu√©s par d√©faut

Possibilit√© de "d√©sarchiver" pour r√©afficher

Gestion des comptes
Entit√© Account
Un compte est une entit√© financi√®re sp√©cifique au sein d'une banque d√©clar√©e. Un compte peut √™tre un compte ch√®ques, compte √©pargne, compte titre, cr√©dit renouvelable, etc.

Attributs d'un Account

Identifiant unique : UUID g√©n√©r√©

Banque parente : R√©f√©rence √† Bank

Nom : Cha√Æne de caract√®res (ex: "Ch√®ques Perso", "√âpargne Projet")

Type de compte : Cat√©gorie enum (checking, savings, credit, investment, loan, other)

IBAN/Num√©ro de compte : Num√©ro de compte masqu√©e partiellement (ex: "FR76 XXXXXXXX XXXX 1234")

Devise : Devise du compte (EUR, USD, GBP, etc.)

Solde actuel : Montant d√©cimal (mis √† jour apr√®s chaque import)

Solde actuel date : Timestamp du dernier √©quilibrage

Date de derni√®re transaction : Pour rep√©rage rapidement comptes actifs

M√©tadonn√©es d'import : JSON contenant info du dernier import OFX (date, nombre de transactions, source)

Actif : Bool√©en (compte encore utilis√© ou archiv√©)

D√©tect√© automatiquement : Bool√©en (cr√©√© par import OFX vs cr√©√© manuellement)

Date de cr√©ation : Timestamp

Date de modification : Timestamp

Cr√©ation de comptes
Automatique via import OFX :

Lors de l'import d'un fichier OFX, l'application parcourt les comptes pr√©sents

Pour chaque compte d√©tect√© :

V√©rifie si compte existe d√©j√† dans la banque (par IBAN/num√©ro)

Si existe : met √† jour solde et m√©tadonn√©es import

Si n'existe pas : cr√©e nouveau compte avec "d√©tect√© automatiquement = true"

Affecte la banque correcte (voir section Import et d√©tection)

Manuelle via UI :

Clic sur "Ajouter un compte" dans le panneau (accessible via menu banque ou apr√®s s√©lection banque)

Ouvre formulaire avec champs name, type, IBAN (optionnel), devise

Cr√©ation compte avec "d√©tect√© automatiquement = false"

Affichage des comptes
Les comptes apparaissent dans le panneau vertical sous leur banque parente (quand banque est expandue).

Informations affich√©es par compte

Ic√¥ne type compte (ic√¥ne ch√®ques, √©pargne, cr√©dit selon type)

Nom du compte

Solde actuel (si connaissance du solde)

Devise

Derni√®re synchronisation (date/heure relative)

Badge "Nouveau" si compte d√©tect√© lors dernier import (pendant 24h)

Interactions sur compte

Clic : Peut ouvrir vue d√©tails compte OU aller √† liste transactions filtr√©es par compte

Menu contextuel : √âditer (renommer), archiver, supprimer, voir d√©tails

Suppression/Archivage compte
M√™me logique que banque : suppression avec confirmation si transactions existent, ou archivage non-destructif.

Import et d√©tection
Workflow d'import OFX
Point d'entr√©e :

Page d√©di√©e "Importer des transactions" (accessible depuis menu principal)

OU action rapide "Importer" depuis panneau bancaire (clic bouton avec ic√¥ne upload)

√âtape 1 : Upload et s√©lection de la banque
Formulaire d'upload

Zone drag-and-drop : Accepte fichiers .ofx, .ofxheader

Validations :

Fichier doit √™tre format OFX valide

Message d'erreur si format invalide

Limite de taille (ex: 10 MB)

S√©lection de la banque cible

Apr√®s upload, utilisateur doit sp√©cifier : "√Ä quelle banque appartiennent ces donn√©es?"

Dropdown/S√©lecteur : Liste des banques d√©clar√©es

Texte d'aide : "S√©lectionnez la banque d'o√π proviennent ces transactions"

Condition : Si aucune banque d√©clar√©e, rediriger vers formulaire d'ajout de banque (cf. section gestion banques)

Raison de cette √©tape :

Application ne fait pas confiance au fichier OFX pour identifier la banque

Utilisateur doit valider explicitement : "oui, ces comptes sont de cette banque"

Pr√©vient les erreurs o√π deux fichiers OFX de banques diff√©rentes se m√©langeraient

√âtape 2 : Parsing et d√©tection des comptes
Processus invisible √† l'utilisateur (se d√©roulant c√¥t√© serveur)

Parse du fichier OFX : Extraction structure du fichier

Chaque bloc <STMTRS> (statement response) = un compte

Extraction : IBAN/num√©ro compte, solde, devise, liste transactions

Appariement avec comptes existants

Pour chaque compte d√©tect√© dans OFX :

Cherche compte existant dans la banque avec m√™me IBAN/num√©ro

Si trouv√© : lier les donn√©es du OFX √† ce compte (update)

Si non trouv√© : marquer comme "nouveau compte √† cr√©er"

Pr√©-traitement des transactions

Pour chaque transaction du OFX :

Extraire : date, montant, description, IBAN b√©n√©ficiaire (si pr√©sent)

V√©rifier doublon (via combinaison date+montant+description)

Classer transaction (cf. section Classification des transactions)

√âtape 3 : Preview avant confirmation
Affichage des modifications propos√©es

Section "Comptes d√©tect√©s" :

Tableau avec comptes trouv√©s dans OFX

Colonnes : IBAN (masqu√©), Nom compte (inf√©r√© ou suggestion), Solde, Devise, Statut (Nouveau / Existant)

Permettre renommer comptes d√©tect√©s avant import

Section "Transactions √† importer" :

Nombre total de transactions d√©tect√©es

Nombre de transactions d√©j√† import√©es (doublons d√©tect√©s)

Nombre de transactions nouvelles

Tableau preview : premiers 10-20 transactions avec date, description, montant, classification

Section "Transactions potentiellement probl√©matiques" :

Transactions class√©es "Unknown" (compte dest non d√©clar√©)

Transactions sans description

Transactions avec montant = 0

Affichage warning/info pour chacune

Actions

Importer : Valide les comptes renomm√©s et proc√®de √† import en BD

Annuler : Retour sans changement

√âditer noms comptes : Formulaire rapide pour renommer avant import

√âtape 4 : Import et cr√©ation donn√©es
Processus atomique

Cr√©ation de nouveaux comptes d√©tect√©s

Cr√©ation de toutes transactions nouvelles (rejet des doublons silencieusement)

Mise √† jour solde des comptes

Enregistrement m√©tadonn√©es import (date, nombre, source)

Transaction DB : tout r√©ussit ou tout √©choue

Feedback utilisateur

√âcran confirmation : "X transactions import√©es, Y comptes cr√©√©s, Z doublons ignor√©s"

Redirection vers dashboard OU liste transactions filtr√©e par comptes importer

D√©tection de la banque depuis OFX
Contexte : Le fichier OFX contient-il des indices permettant identifier la banque?

R√©alit√© technique :

Standard OFX ne contient pas toujours identifiant bancaire explicite

Certains OFX incluent code bancaire (BIC/SWIFT) ou URL

Mais ce n'est pas garantie

Approche FinanceTrack :

Ne pas essayer de d√©duire automatiquement la banque

Toujours demander utilisateur de sp√©cifier la banque (√©tape 1)

Optionnel : afficher suggestion si OFX contient un code BIC reconnaissable (ex: "Semble √™tre Soci√©t√© G√©n√©rale - SOGEDFF22. Correct?")

But : garantir utilisateur contr√¥le quels donn√©es vont √† quelle banque

Classification des transactions
Syst√®me de classification
Chaque transaction re√ßoit une classification qui d√©termine :

Comment elle s'affiche dans les filtres

Si elle est masqu√©e par filtre "masquer virements internes"

Comment elle impacte les statistiques budg√©taires

Types de classification
1. External (Externe)
D√©finition : Transaction entre le compte et une entit√© externe (non g√©r√©e dans l'app)

Cas d'usage

Paiement commercial : achat Amazon, restaurant, supermarch√©

Revenu externe : salaire, allocation, remboursement d'ami

Virement vers compte tiers non d√©clar√© dans l'app

R√®gles de d√©tection

Compte b√©n√©ficiaire ne figure pas dans la BD de comptes de l'utilisateur

OU aucune tentative de matching avec compte existant

OU description indique tiers (AMAZON, SNCF, etc.)

Impacte :

Comptabilis√©e dans budgets et statistiques

Appara√Æt toujours dans listes transactions

Pas affect√©e par filtre "masquer virements internes"

Exemples

text
Compte: SG Ch√®ques
Description: PAIEMENT AMAZON
Montant: -49.99‚Ç¨
Classification: External
text
Compte: SG Ch√®ques  
Description: SALAIRE JANVIER
Montant: +2500‚Ç¨
Classification: External
2. Internal Intra-Bank (Interne intra-bancaire)
D√©finition : Virement entre deux comptes du m√™me utilisateur au sein de la m√™me banque

Cas d'usage

Transfert compte ch√®ques ‚Üí compte √©pargne (m√™me banque)

Transfert compte courant ‚Üí compte cr√©dit (m√™me banque)

Quelconque virement entre comptes d'une m√™me banque

R√®gles de d√©tection

Compte b√©n√©ficiaire existe dans BD ET appartient √† m√™me banque que compte source

Description contient indices virement (VIREMENT, TRANSFER, VERSEMENT)

Impacte :

Ne comptabilis√©e PAS dans budgets/statistiques par d√©faut (virement interne)

Masqu√©e si filtre "masquer virements internes" activ√©

Mais visible dans d√©tails compte si "show all transactions"

Exemples

text
Compte source: SG Ch√®ques
Compte dest: SG √âpargne (d√©tect√©e dans BD)
Description: VIREMENT √âPARGNE
Montant: +500‚Ç¨
Classification: Internal Intra-Bank
3. Internal Inter-Bank (Interne inter-bancaire)
D√©finition : Virement entre deux comptes du m√™me utilisateur dans des banques diff√©rentes

Cas d'usage

Transfert SG Ch√®ques ‚Üí BNP √âpargne

Transfert Revolut ‚Üí Soci√©t√© G√©n√©rale

Quelconque virement entre banques d√©clar√©es

R√®gles de d√©tection

Compte b√©n√©ficiaire existe dans BD

Compte source et b√©n√©ficiaire appartiennent √† banques diff√©rentes (mais m√™me user)

Description sugg√®re virement

Impacte :

M√™me comportement que Intra-Bank : ne comptabilis√©e pas, masqu√©e avec filtre

Trait√© identiquement pour filtrage (virements internes = Intra-Bank + Inter-Bank)

Exemples

text
Compte source: SG Ch√®ques
Compte dest: BNP √âpargne (d√©tect√©e dans BD, banque diff√©rente)
Description: VIREMENT BNP
Montant: +500‚Ç¨
Classification: Internal Inter-Bank
4. Unknown (Inconnu)
D√©finition : Transaction o√π compte b√©n√©ficiaire ne peut pas √™tre identifi√©

Cas d'usage

Virement vers compte externe (tiers non d√©clar√©)

IBAN/num√©ro de compte mal format√© ou non extractible

Description ambigu√´

Donn√©es manquantes

R√®gles de d√©tection

Tentative de matching avec comptes BD retourne z√©ro r√©sultat

IBAN/num√©ro b√©n√©ficiaire non extractible du OFX

Impacte :

Comptabilis√©e comme transaction External (par d√©faut)

Affichage warning/badge "Compte destinataire non identifi√©"

Utilisateur peut corriger classification manuelle (si souhaite marquer comme interne)

Utile pour tracer tentatives virements vers comptes oubli√©s

Exemples

text
Compte source: SG Ch√®ques
Description: VIREMENT √Ä MARC
Montant: -200‚Ç¨
Compte dest: ????? (pas trouv√© dans BD)
Classification: Unknown
Extraction de l'IBAN b√©n√©ficiaire depuis OFX
Comment l'app d√©termine le compte b√©n√©ficiaire?

Le standard OFX est limit√© pour data structur√©e. L'app doit utiliser plusieurs strat√©gies :

Champs structur√©s du OFX

Si OFX contient bloc <XFERINFO> avec IBAN b√©n√©ficiaire : utiliser directement

Format : <XFERINFO><BANKID>SOGEDFFXXX</BANKID><ACCTID>FR1234567890</ACCTID></XFERINFO>

Analyse du champ description

Certains fichiers OFX incluent IBAN/BIC en description

Regex pattern pour d√©tecter IBAN (FR76 XXXX XXXX XXXX XXXX)

Extraction du premier IBAN trouv√© en description

Matching par num√©ro de compte partiel

Si description contient "4 derniers chiffres" : chercher compte BD finissant par ces chiffres

Exemple : "VIR √Ä COMPTE 1234" + compte BNP finissant 1234 = match probable

Fallback : lecture manuelle

Si aucune m√©thode r√©ussit : marquer Unknown

Affichage description brute √† utilisateur

Possibilit√© post-import d'√©diter transaction et sp√©cifier manuellement le compte

Matching du compte b√©n√©ficiaire
Logique de matching

Pour chaque transaction analys√©e :

Extraire IBAN/num√©ro de compte b√©n√©ficiaire (via strat√©gies ci-dessus)

Requ√™te BD : chercher compte avec :

WHERE profileId = {current_user} AND account.iban = {extracted_iban}

OU : WHERE profileId = {current_user} AND account.accountNumber LIKE '%{last4digits}%'

R√©sultats :

Exactement 1 compte trouv√© = match, classification External/Intra/Inter d√©cid√©e

Z√©ro compte trouv√© = Unknown

Plusieurs comptes trouv√©s (cas rare) = utiliser le plus r√©cent / demander clarification

Masquage partiel des IBAN en affichage

Lors affichage du compte b√©n√©ficiaire : afficher "FR76 XXXX XXXX XXXX 1234" (masquer les chiffres du milieu)

Pr√©venir vol IBAN en affichage accidentel

Classification des transactions (d√©tails algorithmiques)
Algorithme de classification
Entr√©e : Transaction extraite de OFX avec :

sourceAccount: Compte source

amount: Montant sign√© (+/-)

description: Libell√©

extractedBeneficiaryIban: IBAN b√©n√©ficiaire (ou null)

Sortie : Classification enum + confiance score 0-1

Logique

text
√âtape 1: Analyser description pour indices
  - Si description contient ("VIREMENT", "TRANSFER", "VIR", "VERSEMENT"):
      est_probablement_virement = true
  - Sinon:
      est_probablement_virement = false

√âtape 2: Chercher compte b√©n√©ficiaire
  Si extractedBeneficiaryIban existe:
    beneficiary_account = rechercherCompte(extractedBeneficiaryIban)
    Si beneficiary_account existe:
      √âtape 3A: Comptes trouv√©s
    Sinon:
      √âtape 3B: Compte non trouv√©
  Sinon:
    √âtape 3B: Pas d'IBAN extractible

√âtape 3A: Comptes trouv√©s
  Si sourceAccount.bankId == beneficiary_account.bankId:
    Classification = Internal Intra-Bank
    Confiance = 0.95
  Sinon:
    Classification = Internal Inter-Bank  
    Confiance = 0.95

√âtape 3B: Compte non trouv√© OU pas d'IBAN
  Classification = Unknown
  Confiance = 0.30
  Note: Sera affich√© comme "potentially external" dans UI

√âtape 4: Enrichissement description
  Si est_probablement_virement ET classification == Unknown:
    # C'est un virement mais vers tiers
    Classification = External (virement)
    Confiance = 0.70
  Sinon si NOT est_probablement_virement ET classification == Unknown:
    Classification = External (paiement)  
    Confiance = 0.65
Scenarios de test de classification
Scenario 1: Paiement classique

Compte source: SG Ch√®ques

Description: "PAIEMENT AMAZON"

IBAN b√©n√©ficiaire: non extractible

Classification: External ‚úì

Confiance: 0.65

Scenario 2: Virement intra-bancaire

Compte source: SG Ch√®ques (ID: sg-1)

Description: "VIREMENT √âPARGNE"

IBAN b√©n√©ficiaire: FR1234567890 (compte SG √âpargne dans BD)

√âtape 3A: banques identiques

Classification: Internal Intra-Bank ‚úì

Confiance: 0.95

Scenario 3: Virement inter-bancaire

Compte source: SG Ch√®ques (bank_id: sg)

Description: "VIREMENT BNP"

IBAN b√©n√©ficiaire: FR9876543210 (compte BNP √âpargne dans BD, bank_id: bnp)

√âtape 3A: banques diff√©rentes

Classification: Internal Inter-Bank ‚úì

Confiance: 0.95

Scenario 4: Virement vers tiers (non d√©clar√©)

Compte source: SG Ch√®ques

Description: "VIREMENT √Ä MARC"

IBAN b√©n√©ficiaire: null (non extractible)

√âtape 3B: pas d'IBAN

But: est_probablement_virement=true

Classification: External (virement) ‚úì

Confiance: 0.70

Scenario 5: Inconnu

Compte source: SG Ch√®ques

Description: "DIVERS"

IBAN b√©n√©ficiaire: null

est_probablement_virement: false

Classification: Unknown

Confiance: 0.30

Interface utilisateur
Layout global de la landing page (Dashboard)
Structure g√©n√©rale

text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                   ZONE PRINCIPALE                         ‚îÇ  PANNEAU     ‚îÇ
‚îÇ                 (Dashboard + Analytics)                   ‚îÇ  VERTICAL    ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ  Banques &   ‚îÇ
‚îÇ                                                            ‚îÇ  Comptes     ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îÇ                                                            ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Zone principale (Dashboard)
Contenu

Top section : Overview financier

Solde total (toutes banques/comptes combin√©s)

Revenus ce mois

D√©penses ce mois

Variation ce mois vs mois pr√©c√©dent

Graphiques/Charts

Pie chart : r√©partition d√©penses par cat√©gorie

Line chart : √©volution solde sur 3 mois

Bar chart : revenus vs d√©penses par mois

Liste transactions r√©centes

Derni√®res 10-20 transactions

Colonnes : date, description, montant, compte, cat√©gorie

Filtres/tri rapides : par compte, par cat√©gorie, par type (d√©pense/revenu)

Panneau vertical (droite)
Dimensions et positionnement

Largeur fixe : 280-320px

Position : fixed ou sticky √† droite

Hauteur : 100vh (full viewport height) ou scrollable ind√©pendamment

Responsive : sur mobile, devient overlay/drawer ou s'affiche en haut

Contenu du panneau

Header du panneau
Titre "Banques & Comptes"

Ic√¥ne collapse/expand pour r√©duire panneau (mobile)

Spacing coh√©rent avec zone principale

Zone de banques
Titre section : "Banques" (petit, gris√©)

Barre de recherche (optionnel) : Chercher une banque par nom

Liste des banques

text
üè¶ Soci√©t√© G√©n√©rale                    [‚ãÆ]
   ‚îî‚îÄ Ch√®ques Perso        1,250.50‚Ç¨
   ‚îî‚îÄ √âpargne Projet         500.00‚Ç¨

üè™ BNP Paribas                         [‚ãÆ]
   ‚îî‚îÄ Ch√®ques              2,100.00‚Ç¨

üì± Revolut                             [‚ãÆ]
   ‚îî‚îÄ Revolut EUR             200.00‚Ç¨
Chaque banque

Ic√¥ne + couleur (couleur hex de la banque)

Nom de la banque

Badge/indication du nombre de comptes

Chevron expand/collapse

Menu (‚ãÆ) : √©diter, archiver, supprimer

Comptes imbriqu√©s (visibles si banque expandue)

Indentation visuelle (padding-left)

Ic√¥ne type compte

Nom du compte

Solde actuel (ou "---" si inconnu)

Date derni√®re synchronisation (ex: "Il y a 2 jours")

Menu contextuel : √©diter, archiver, supprimer

Bouton d'action
"Ajouter une banque" (ou "+ Nouvelle")

Position : bas du panneau, largeur 100%

Style : button primary

Action : ouvre modal d'ajout

Filtrage des transactions
Filtre "Masquer virements internes"
Emplacement : Barre de filtres au-dessus liste transactions (zone principale)

Comportement

Checkbox ou toggle switch : "Masquer les virements internes"

Quand activ√© : les transactions class√©es Internal Intra-Bank ET Internal Inter-Bank disparaissent de l'affichage

Les transactions Unknown sont TOUJOURS affich√©es (non certains qu'elles soient internes)

Persisten : pr√©f√©rence sauvegard√©e dans localStorage/BD user

Impact

List transactions : filtre automatiquement

Graphiques : recalcul√©s sans virements internes (statistiques "vraies")

Budgets : non affect√©s (budgets ne comptabilisent d√©j√† que virements externes)

Exemples avec filtre activ√©

text
Avant filtrage:
- 50‚Ç¨ Amazon (External) ‚úì Affich√©
- 500‚Ç¨ VIR √âPARGNE (Intra-Bank) ‚úó Masqu√©
- 200‚Ç¨ VIR MARC (Unknown) ‚úì Affich√©
- 300‚Ç¨ RESTO (External) ‚úì Affich√©

Apr√®s filtrage (avec "Masquer virements internes" ON):
- 50‚Ç¨ Amazon (External)
- 200‚Ç¨ VIR MARC (Unknown)
- 300‚Ç¨ RESTO (External)

Apr√®s filtrage (avec "Masquer virements internes" OFF):
- 50‚Ç¨ Amazon (External)
- 500‚Ç¨ VIR √âPARGNE (Intra-Bank)
- 200‚Ç¨ VIR MARC (Unknown)
- 300‚Ç¨ RESTO (External)
Autres filtres (cohabitation avec "Masquer virements")
Par compte

Par cat√©gorie

Par date

Par montant

Par description (recherche)

Par type (d√©pense/revenu/virement)

Tous les filtres se composent : un filtre "type" qui masque virements internes ET un filtre par cat√©gorie par exemple = r√©sultats filtr√©s sur les deux crit√®res.

Workflows et interactions
Workflow 1 : Premier d√©marrage (onboarding)
√âtapes

Utilisateur se connecte pour la premi√®re fois

Dashboard vide, panneau "Banques & Comptes" vide

Prompt automatique : "Commen√ßons! Ajoutez votre premi√®re banque"

Clic : ouvre modal d'ajout de banque

Utilisateur remplit formulaire (nom, couleur, emoji)

Banque cr√©√©e

Prompt : "Pr√™t √† importer vos transactions?"

Clic : redirige vers page Import

Upload fichier OFX

S√©lectionne banque (d√©j√† cr√©√©e)

Preview comptes/transactions

Import confirm√©

Comptes cr√©√©s automatiquement

Transactions affich√©es dans dashboard

Panneau "Banques & Comptes" maintenant peupl√©

Workflow 2 : Import r√©gulier de transactions
Entr√©e : Utilisateur a d√©j√† banques et comptes, re√ßoit fichier OFX mensuel

√âtapes

Acc√®s √† page "Importer" (via menu ou bouton "Importer" depuis panneau)

Upload fichier OFX

S√©lectionne banque source (dropdown, propos√©e par d√©faut si une seule)

Parsing et d√©tection des comptes existants

Preview : "X transactions nouvelles, Y doublons, Z probl√®mes"

Utilisateur revoit les comptes (pr√©-remplis, pas de renommage si existant)

Clic "Importer" : transactions + soldes actualis√©s

Feedback : "100 transactions import√©es!"

Redirection vers liste transactions (filtr√©e par comptes importer)

Workflow 3 : Ajouter une banque en cours d'utilisation
Entr√©e : Utilisateur utilise app depuis plusieurs mois, ouvre nouveau compte dans nouvelle banque

√âtapes

Re√ßoit fichier OFX de la nouvelle banque

Essaie importer : dropdown "Quelle banque?" vide pour nouvelle banque

Clic "Ajouter une banque"

Modal s'ouvre

Remplit formulaire (ex: "Cr√©dit Agricole")

Cr√©ation banque

Retour √† import avec la nouvelle banque pr√©-s√©lectionn√©e

Continue import (cf. Workflow 2)

Workflow 4 : Identifier un virement interne non d√©tect√© (correction)
Entr√©e : Utilisateur voit transaction class√©e "External" qu'il sait √™tre interne (par exemple, compte b√©n√©ficiaire n'a pas √©t√© cr√©√© au moment de l'import)

√âtapes

Utilisateur va dans liste transactions

Voit transaction "VIREMENT √Ä MA NOUVEAU √âPARGNE -500‚Ç¨" class√©e External (badge rouge/warning)

Clic sur transaction : ouvre d√©tails/√©dition

Possibilit√© de changer la classification (dropdown) : "Interne vers compte..." avec auto-complete des comptes

S√©lectionne le compte b√©n√©ficiaire correct

Classification mise √† jour automatiquement : Internal Intra-Bank ou Inter-Bank

Sauvegarde

Graphiques/statistiques recalcul√©s sans cette transaction si filtre "masquer virements" actif

Workflow 5 : Gestion des comptes d√©tect√©s vs manuels
Contexte : L'app cr√©e comptes automatiquement lors imports, mais utilisateur peut aussi cr√©er manuellement

Cr√©√© automatiquement (badge "Auto-d√©tect√©")

Solde √† jour apr√®s chaque import

√âditable (renommable)

M√©tadonn√©es import visibles (derni√®re date, source)

Archivable

Cr√©√© manuellement

Pas de solde autom. (√† saisir manuellement)

√âditable

No m√©tadonn√©es import

Archivable

Diff√©renciation visuelle (optionnel) : Badge petit "Auto" sur comptes d√©tect√©s

Workflow 6 : Masquer comptes/banques archiv√©s
Entr√©e : Utilisateur veut "nettoyer" l'affichage en archivant ancienne banque

√âtapes

Clic menu (‚ãÆ) sur banque dans panneau

S√©lectionne "Archiver" (ou "Supprimer")

Si "Archiver" :

Banque move √† section "Banques archiv√©es" (section repli√©e en bas du panneau)

Comptes et transactions restent en BD (non supprim√©s)

Comptes n'apparaissent plus dans listes filtr√©es par compte

Solde total dashboard = exclut banques archiv√©es par d√©faut

Si besoin, utilisateur peut "D√©sarchiver" pour r√©afficher

Workflow 7 : Comparaison virements internes vs externes
Entr√©e : Utilisateur g√©n√®re rapport mensuel pour comprendre flux financiers r√©els

√âtapes

Va page Analytics/Rapports

Voit deux affichages possibles :

Avec virements internes : flux bruts (moins utile pour analyser d√©penses r√©elles)

Sans virements internes : flux nets (ce qui "quitte r√©ellement" mon patrimoine)

Toggle/bouton pour basculer entre les deux vues

Graphiques, statistiques mises √† jour

Exemple : "D√©penses r√©elles = 2,500‚Ç¨ (sans virements internes)" vs "Mouvements totaux = 4,500‚Ç¨"

D√©tails des interactions
Menu contextuel d'une banque
Acc√®s : Clic sur ic√¥ne (‚ãÆ) √† droite du nom de la banque

Options affich√©es

√âditer ‚Üí Ouvre modal d'√©dition (champs pr√©remplis)

Importer depuis OFX (optionnel) ‚Üí Acc√®s rapide import avec banque pr√©-s√©lectionn√©e

Voir solde total (optionnel) ‚Üí Tooltip affichant somme comptes de cette banque

Archiver ‚Üí Confirmation + archivage

Supprimer ‚Üí Confirmation + suppression cascade

Menu contextuel d'un compte
Acc√®s : Clic sur ic√¥ne (‚ãÆ) √† droite du compte (quand banque expandue)

Options affich√©es

√âditer ‚Üí Modal pour renommer, changer type, etc.

Voir d√©tails ‚Üí Page d√©tails compte (solde, historique, m√©tadonn√©es import)

Aller aux transactions ‚Üí Liste transactions filtr√©e par ce compte

Archiver ‚Üí Confirmation + archivage

Supprimer ‚Üí Confirmation avec warning sur nombre transactions

Modal d'√©dition d'une banque
Champs pr√©-remplis

Nom

Couleur

Emoji/Ic√¥ne

Notes

Actions

Sauvegarder ‚Üí Met √† jour BD, ferme modal, refresh panneau

Annuler ‚Üí Ferme sans changement

Modal d'√©dition d'un compte
Champs pr√©-remplis

Nom du compte

Type (dropdown : Ch√®ques, √âpargne, Cr√©dit, etc.)

IBAN/Num√©ro (lecture seule ou √©ditable selon contexte)

Devise

Actif (toggle)

Affichage suppl√©mentaire

Statut : "D√©tect√© automatiquement" ou "Cr√©√© manuellement"

Solde actuel (si connu) + date

Derni√®re synchronisation

Nombre de transactions

Actions

Sauvegarder ‚Üí Mise √† jour, ferme modal

Annuler ‚Üí Ferme sans changement

Restrictions et contraintes m√©tier
Immuabilit√© de certaines donn√©es
Les donn√©es suivantes ne peuvent pas √™tre modifi√©es apr√®s cr√©ation :

IBAN/Num√©ro de compte (immuable, cl√© d'identification)

Devise du compte (immuable)

Bank d'un compte (immuable)

Justification : Ce sont les cl√©s d'identification. Les modifier casserait lien entre comptes/transactions.

Suppression en cascade
Suppression banque ‚Üí supprime comptes + transactions
Suppression compte ‚Üí supprime transactions
Suppression transaction ‚Üí isol√©e (aucun impact)

Confirmation requise pour suppressions destructives (donn√©es > 5 ou transactions > 0)

Archivage vs suppression
Privil√©gier l'archivage √† la suppression pour data conservatrice :

Donn√©es jamais perdues

Possibilit√© "undo" via d√©sarchivage

Audit trail pr√©serv√©

Unicit√© et doublons
Transactions uniques par : (accountId, date, amount, description)

Emp√™che doublons lors imports r√©p√©t√©s

Autres informations peuvent varier

Banques uniques par : (profileId, name) - impossible avoir deux "Soci√©t√© G√©n√©rale"

Comptes uniques par : (bankId, IBAN) - impossible avoir deux comptes avec m√™me IBAN dans une banque

S√©curit√© et confidentialit√©
Masquage des IBANs
Affichage :

IBAN complet jamais affich√© sauf dans modal d'√©dition compte

Partout ailleurs : "FR76 XXXX XXXX XXXX 1234" (masquer les 8 chiffres du milieu)

Stockage :

IBAN stock√© en BD normal (pas de chiffrement sp√©cial)

Mais transmission HTTPS obligatoire

Isolation des donn√©es par utilisateur
Rule fondamentale :

Utilisateur ne peut voir/modifier que ses propres banques, comptes, transactions

Chaque requ√™te API filtr√©e par profileId = req.user.id

Pas d'acc√®s "transversal" entre users

Audit logs (optionnel mais recommand√©)
Events √† logger :

Cr√©ation/suppression/archivage de banque

Cr√©ation/suppression/√©dition de compte

Imports (date, nombre transactions, source)

Modifications classifications de transactions

Interactions cross-features
Dashboard et classifications
Graphiques affect√©es par filtre "Masquer virements internes" :

Pie chart d√©penses par cat√©gorie : recalcul√© sans Internal Intra-Bank/Inter-Bank

Line chart solde : recalcul√© (moins fluidifie par virements)

Statistiques "D√©penses ce mois" : exclut virements internes

Exemple

text
Avant filtrage:
- D√©penses brutes : 3,500‚Ç¨
- Dont : 500‚Ç¨ virement √©pargne interne, 3,000‚Ç¨ externe

Apr√®s filtrage (Masquer virements ON):
- D√©penses affich√©es : 3,000‚Ç¨
Cat√©gorisation IA et virements internes
Fluxe

Import OFX d√©tecte comptes + cr√©e transactions

Algorithme classification assigne type (External/Internal/Unknown)

Si Internal : pas d'utilit√© de cat√©gorie (il n'y a pas d'objet √† cat√©goriser)

Champ cat√©gorie : null ou "Transfer" g√©n√©rique

Si External : IA cat√©gorise en fonction description (Amazon ‚Üí Shopping, SNCF ‚Üí Transport, etc.)

Si Unknown : IA essaie cat√©goriser mais confiance basse

Implication UX :

Transactions Intra-Bank/Inter-Bank n'ont PAS de dropdown cat√©gorie (champ gris√©/d√©sactiv√©)

Ou cat√©gorie auto-set √† "Transfer" (non modifiable)

Analytics et virements
Reports mensuels :

Montrent deux variantes : "avec virements internes" et "sans"

Utilisateur comprend diff√©rence entre flux bruts et nets

Cas limites et edge cases
E1 : Compte destinataire cr√©√© apr√®s la transaction
Scenario :

Janvier : Import SG avec transaction vers BNP, BNP pas encore cr√©√©e

Classification: Unknown

F√©vrier : Utilisateur ajoute BNP

M√™me transaction reste Unknown (non re-classifi√©e automatiquement)

Solution :

Option "Re-classifier toutes transactions" (bouton) pour re-analyser toutes Unknown

OU : User √©dite manuellement la transaction et sp√©cifie compte dest

E2 : Compte avec m√™me 4 derniers chiffres dans deux banques
Scenario :

SG Ch√®ques : ...1234

BNP √âpargne : ...1234

Transaction d√©crit seulement "VIR √Ä COMPTE 1234"

Solution :

Extraction IBAN compl√®te prioritaire (pas juste derniers chiffres)

Si ambiguit√© : marquer Unknown et demander user clarifier

Ou : afficher warning lors import "plusieurs comptes match description, lequel?"

E3 : Transaction nulle (montant = 0)
Classification :

Montant 0 = probablement erreur d'import ou placeholder

Affichage warning dans preview import

Importer quand m√™me mais flag pour r√©vision

E4 : IBAN invalide ou malform√©
Parsing OFX :

Validation IBAN selon standard (21-34 caract√®res, checksum IBAN)

Si invalide : skip extraction IBAN, classification -> Unknown

Warning affich√© lors preview

E5 : Virement r√©ciproque (auto-paiement)
Scenario :

Utilisateur transf√®re de SG √† BNP : -500‚Ç¨

Puis re√ßoit cr√©dit BNP : +500‚Ç¨

Deux transactions, m√™me montant, dates proches, m√™me description?

Comportement :

Chaque transaction class√©e s√©par√©ment (c'est techniquement deux transactions)

Utilisateur verra : -500‚Ç¨ (Out) et +500‚Ç¨ (In)

Filtre "Masquer virements" masquera les deux (car toutes deux Internal)

Correct car c'est effectivement deux mouvements (m√™me si r√©ciproques)

Summary des √©l√©ments cl√©s
√âl√©ment	Description	Emplacement
Panel Banques/Comptes	Vue hi√©rarchique banques ‚Üí comptes, gestion ajout/√©dition/suppression	Panneau vertical droit du Dashboard
Modal Ajout Banque	Formulaire nom, couleur, emoji, notes	D√©clench√© depuis panel ou onboarding
Import OFX	Upload ‚Üí s√©lection banque ‚Üí preview ‚Üí confirmation	Page d√©di√©e "Importer"
D√©tection comptes	Auto-cr√©ation comptes depuis OFX, lien √† banque s√©lectionn√©e	Pendant preview import
Classification transactions	External / Intra-Bank / Inter-Bank / Unknown	Transparent (backend)
Filtre virements	Toggle "Masquer virements internes" (Intra + Inter)	Barre filtres au-dessus liste transactions
Matching IBAN	Extraction depuis OFX + matching BD pour identifier comptes dest	Backend parsing
M√©tadonn√©es import	Stockage date/nombre/source par compte	Visible dans d√©tails compte
Menu contexte	Options √©diter/archiver/supprimer sur banques/comptes	Icons (‚ãÆ) √† droite dans panel
Graphiques	Recalcul√©s selon filtre virements	Dashboard Analytics
Conclusion
FinanceTrack est con√ßu autour d'un mod√®le d√©claratif :

L'utilisateur d√©clare ses banques (contr√¥le explicite)

L'application d√©tecte ses comptes depuis OFX (automatisation)

L'application classifie ses transactions (intelligence)

L'utilisateur filtre et visualise (contr√¥le final)